<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자동 프롬프터 시스템</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
            display: flex;
            flex-direction: column;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .title {
            color: white;
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            color: white;
            font-size: 14px;
            font-weight: 500;
        }

        .control-button, .control-input, .control-select {
            padding: 10px 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .control-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .control-button.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }

        .control-input, .control-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .control-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .main-container {
            flex: 1;
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        .editor-panel {
            width: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .editor-title {
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .editor-textarea {
            width: 100%;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 15px;
            color: white;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
        }

        .editor-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .prompter-container {
            flex: 1;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            position: relative;
            min-height: 500px;
        }

        .prompter-screen {
            height: 100%;
            overflow: hidden;
            position: relative;
            padding: 40px;
        }

        .prompter-text {
            color: white;
            font-size: 32px;
            line-height: 1.8;
            text-align: center;
            white-space: pre-line;
            transition: transform 0.1s linear;
            font-weight: 300;
        }

        .mirror-mode .prompter-text {
            transform: scaleX(-1);
        }

        .highlight {
            background: rgba(255, 255, 0, 0.3);
            padding: 2px 4px;
            border-radius: 4px;
        }

        .status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 14px;
        }

        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .sync-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4CAF50;
        }

        .remote-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .remote-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .remote-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .voice-wave {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .wave-bar {
            width: 3px;
            height: 20px;
            background: #4CAF50;
            animation: wave 1s ease-in-out infinite;
        }

        .age-quick-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
            max-width: 200px;
        }

        .age-btn {
            padding: 6px 8px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 11px;
            font-weight: 500;
            min-width: 35px;
            height: 28px;
            position: relative;
        }

        .age-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
        }

        .age-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            transform: scale(1.05);
        }

        .situation-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
        }

        .situation-btn {
            padding: 6px 8px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 10px;
            font-weight: 500;
            min-width: 30px;
            height: 24px;
        }

        .situation-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .situation-btn.active {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.4);
        }

        @keyframes wave {
            0%, 100% { height: 20px; }
            50% { height: 5px; }
        }

        /* 모바일 및 태블릿 반응형 디자인 */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
                padding: 10px;
                gap: 15px;
            }
            
            .editor-panel {
                width: 100%;
                order: 2;
            }
            
            .prompter-container {
                order: 1;
                min-height: 60vh;
            }
            
            .controls {
                gap: 8px;
                justify-content: space-around;
                padding: 0 10px;
            }
            
            .control-group {
                flex: 1;
                min-width: 80px;
            }
            
            .control-button, .control-input, .control-select {
                width: 100%;
                padding: 12px 8px;
                font-size: 12px;
                min-height: 44px;
            }
            
            .control-group label {
                font-size: 12px;
            }
            
            .prompter-text {
                font-size: 28px;
                padding: 20px;
            }
            
            .editor-textarea {
                height: 200px;
                font-size: 16px;
            }
            
            .status-bar {
                padding: 8px 15px;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .remote-controls {
                bottom: 10px;
                right: 10px;
                gap: 8px;
            }
            
            .remote-btn {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 10px;
            }
            
            .title {
                font-size: 24px;
                margin-bottom: 15px;
            }
            
            .controls {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .control-group {
                min-width: 70px;
                margin-bottom: 10px;
            }
            
            .control-button, .control-input, .control-select {
                padding: 10px 6px;
                font-size: 11px;
                border-radius: 20px;
            }
            
            .control-group label {
                font-size: 11px;
                text-align: center;
            }
            
            .prompter-container {
                min-height: 50vh;
                border-radius: 15px;
            }
            
            .prompter-text {
                font-size: 24px;
                padding: 15px;
                line-height: 1.6;
            }
            
            .editor-panel {
                padding: 15px;
                border-radius: 15px;
            }
            
            .editor-textarea {
                height: 150px;
                font-size: 14px;
                border-radius: 10px;
            }
            
            .status-bar {
                font-size: 12px;
                padding: 6px 10px;
            }
            
            .recording-indicator, .sync-indicator {
                font-size: 11px;
            }
            
            .remote-controls {
                bottom: 80px;
                right: 8px;
            }
            
            .remote-btn {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
        }

        /* 터치 디바이스 최적화 */
        @media (hover: none) and (pointer: coarse) {
            .control-button, .control-input, .control-select, .remote-btn, .age-btn, .situation-btn {
                -webkit-tap-highlight-color: rgba(255, 255, 255, 0.2);
                touch-action: manipulation;
            }
            
            .control-button:active, .remote-btn:active, .age-btn:active, .situation-btn:active {
                transform: scale(0.95);
                transition: transform 0.1s;
            }
            
            .prompter-screen::-webkit-scrollbar {
                display: none;
            }
            
            .prompter-screen {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">자동 프롬프터 시스템</h1>

        <div class="controls">
            <div class="control-group">
                <label>자동 스크롤</label>
                <button id="autoScrollBtn" class="control-button">시작</button>
            </div>
            
            <div class="control-group">
                <label>스크롤 속도</label>
                <input type="range" id="speedSlider" class="control-input" min="1" max="10" value="5" style="width: 100px;">
            </div>
            
            <div class="control-group">
                <label>글자 크기</label>
                <select id="fontSizeSelect" class="control-select">
                    <option value="24">24px</option>
                    <option value="32" selected>32px</option>
                    <option value="40">40px</option>
                    <option value="48">48px</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>미러 모드</label>
                <button id="mirrorBtn" class="control-button">OFF</button>
            </div>
            
            <div class="control-group">
                <label>음성 동기화</label>
                <button id="voiceBtn" class="control-button">시작</button>
            </div>
            
            <div class="control-group">
                <label>연령대 선택</label>
                <select id="ageGroupSelect" class="control-select">
                    <option value="basic">기본 스크립트</option>
                    <option value="20s">20대 버전</option>
                    <option value="30s">30대 버전</option>
                    <option value="40s">40대 버전</option>
                    <option value="50s">50대 버전</option>
                    <option value="60s">60대 버전</option>
                    <option value="70s">70대+ 버전</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>연령대 바로가기</label>
                <div class="age-quick-buttons">
                    <button id="age20Btn" class="age-btn" title="키보드: Ctrl+2">20대</button>
                    <button id="age30Btn" class="age-btn" title="키보드: Ctrl+3">30대</button>
                    <button id="age40Btn" class="age-btn" title="키보드: Ctrl+4">40대</button>
                    <button id="age50Btn" class="age-btn" title="키보드: Ctrl+5">50대</button>
                    <button id="age60Btn" class="age-btn" title="키보드: Ctrl+6">60대</button>
                    <button id="age70Btn" class="age-btn" title="키보드: Ctrl+7">70+</button>
                </div>
            </div>
            
            <div class="control-group">
                <label>투자금액 설정</label>
                <input type="text" id="investmentInput" class="control-input" placeholder="3000만원" value="3000만원" style="width: 80px;">
            </div>
            
            <div class="control-group">
                <label>월세금액 설정</label>
                <input type="text" id="monthlyRentInput" class="control-input" placeholder="60만원" value="60만원" style="width: 80px;">
            </div>
            
            <div class="control-group">
                <label>상황별 대응</label>
                <div class="situation-buttons">
                    <button id="busyBtn" class="situation-btn" title="키보드: B">바빠요</button>
                    <button id="okayBtn" class="situation-btn" title="키보드: O">괜찮아요</button>
                    <button id="textBtn" class="situation-btn" title="키보드: T">문자주세요</button>
                    <button id="unknownBtn" class="situation-btn" title="키보드: U">모르겠어요</button>
                </div>
            </div>
            
            <div class="control-group">
                <label>리셋</label>
                <button id="resetBtn" class="control-button">↻</button>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="editor-panel">
            <h3 class="editor-title">대본 편집</h3>
            <textarea id="scriptEditor" class="editor-textarea" placeholder="여기에 대본을 입력하세요..."></textarea>
        </div>

        <div class="prompter-container" id="prompterContainer">
            <div class="prompter-screen">
                <div id="prompterText" class="prompter-text">
안녕하세요. 대우건설에서 전화드렸는데요.

실투자금 3000만원대로 사무실 한 채 소유하셔서 매달 60만원씩 월세 받아보시라고 연락드렸는데요.

제 말처럼 3000만원대로 매달 60만원씩 월세 나온다고 하시면 좋으신 거 알고 계시죠?

이런 거 한번 알아보시라고 연락드렸는데요.

왜냐하면 지금 목소리 들어보니까 나이대가 [연령대] 정도 같으신데 맞으시죠?

그럼 따로 월세 받는것도 있으시죠?
                </div>
            </div>

            <div class="status-bar">
                <div class="recording-indicator" id="recordingIndicator" style="display: none;">
                    <div class="recording-dot"></div>
                    <span>음성 인식 중...</span>
                    <div class="voice-wave">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                    </div>
                </div>
                
                <div class="sync-indicator" id="syncIndicator">
                    <span>동기화 준비</span>
                </div>
                
                <div>속도: <span id="currentSpeed">5</span>/10</div>
            </div>
        </div>
    </div>

    <div class="remote-controls">
        <button class="remote-btn" id="remoteUp" title="위로 스크롤">↑</button>
        <button class="remote-btn" id="remotePause" title="일시정지">⏸</button>
        <button class="remote-btn" id="remoteDown" title="아래로 스크롤">↓</button>
    </div>

    <script>
        // 전역 변수
        let isAutoScrolling = false;
        let scrollSpeed = 5;
        let currentPosition = 0;
        let animationId = null;
        let isMirrorMode = false;
        let isVoiceRecognition = false;
        let recognition = null;
        let recognizedText = '';
        let currentWordIndex = 0;
        let scriptWords = [];
        let lastSpeechTime = Date.now();
        let speechRate = 0;

        // DOM 요소 가져오기
        const autoScrollBtn = document.getElementById('autoScrollBtn');
        const speedSlider = document.getElementById('speedSlider');
        const fontSizeSelect = document.getElementById('fontSizeSelect');
        const mirrorBtn = document.getElementById('mirrorBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const resetBtn = document.getElementById('resetBtn');
        const ageGroupSelect = document.getElementById('ageGroupSelect');
        const age20Btn = document.getElementById('age20Btn');
        const age30Btn = document.getElementById('age30Btn');
        const age40Btn = document.getElementById('age40Btn');
        const age50Btn = document.getElementById('age50Btn');
        const age60Btn = document.getElementById('age60Btn');
        const age70Btn = document.getElementById('age70Btn');
        const investmentInput = document.getElementById('investmentInput');
        const monthlyRentInput = document.getElementById('monthlyRentInput');
        const busyBtn = document.getElementById('busyBtn');
        const okayBtn = document.getElementById('okayBtn');
        const textBtn = document.getElementById('textBtn');
        const unknownBtn = document.getElementById('unknownBtn');
        const scriptEditor = document.getElementById('scriptEditor');
        const prompterText = document.getElementById('prompterText');
        const prompterContainer = document.getElementById('prompterContainer');
        const currentSpeedDisplay = document.getElementById('currentSpeed');
        const recordingIndicator = document.getElementById('recordingIndicator');
        const syncIndicator = document.getElementById('syncIndicator');
        const remoteUp = document.getElementById('remoteUp');
        const remotePause = document.getElementById('remotePause');
        const remoteDown = document.getElementById('remoteDown');

        // 자동 스크롤 기능
        function startAutoScroll() {
            if (animationId) cancelAnimationFrame(animationId);
            
            function scroll() {
                currentPosition += scrollSpeed * 0.5;
                prompterText.style.transform = `translateY(-${currentPosition}px)`;
                
                if (isAutoScrolling) {
                    animationId = requestAnimationFrame(scroll);
                }
            }
            
            if (isAutoScrolling) {
                animationId = requestAnimationFrame(scroll);
            }
        }

        // 연령대별 스크립트 데이터
        const ageScripts = {
            basic: `안녕하세요. 대우건설에서 전화드렸는데요.

실투자금 3000만원대로 사무실 한 채 소유하셔서 매달 60만원씩 월세 받아보시라고 연락드렸는데요.

제 말처럼 3000만원대로 매달 60만원씩 월세 나온다고 하시면 좋으신 거 알고 계시죠?

이런 거 한번 알아보시라고 연락드렸는데요.

왜냐하면 지금 목소리 들어보니까 나이대가 [연령대] 정도 같으신데 맞으시죠?

그럼 따로 월세 받는것도 있으시죠?`,

            '20s': `안녕하세요. 대우건설에서 전화드렸는데요.

실투자금 3000만원대로 사무실 한 채 소유하셔서 매달 60만원씩 월세 받아보시라고 연락드렸는데요.

제 말처럼 3000만원대로 매달 60만원씩 월세 나온다고 하시면 좋으신 거 알고 계시죠?

이런 거 한번 알아보시라고 연락드렸는데요.

왜냐하면 지금 목소리 들어보니까 나이대가 20대 정도 같으신데 맞으시죠?

요즘 청년들이 투자에 관심이 많으시잖아요. 특히 부동산 투자로 경제적 자유를 꿈꾸시는 분들이 많고요.

3000만원으로 시작해서 매달 60만원씩 받으시면, 1년이면 720만원이에요. 이정도면 월급 외에 부수입으로 괜찮지 않으신가요?

요즘 같은 시대에 20대부터 이런 안정적인 수익구조를 만들어 놓으시면, 나중에 결혼하시거나 집 장만할 때 정말 큰 도움이 되실 거예요.

혹시 현재 따로 투자하고 계신 것 있으세요?`,

            '30s': `안녕하세요. 대우건설에서 전화드렸는데요.

실투자금 3000만원대로 사무실 한 채 소유하셔서 매달 60만원씩 월세 받아보시라고 연락드렸는데요.

제 말처럼 3000만원대로 매달 60만원씩 월세 나온다고 하시면 좋으신 거 알고 계시죠?

이런 거 한번 알아보시라고 연락드렸는데요.

왜냐하면 지금 목소리 들어보니까 나이대가 30대 정도 같으신데 맞으시죠?

30대시면 결혼 준비나 신혼집, 아이들 교육비 등 목돈 들어갈 일이 많으시잖아요. 그래서 안정적인 월세 수입이 더욱 필요하실 텐데요.

3000만원 투자로 매달 60만원씩 받으시면 연간 720만원, 10년이면 7200만원이에요. 아이 교육비나 대출 이자에도 많은 도움이 되실 거예요.

요즘 30대 분들이 가장 고민하는 게 내 집 마련이잖아요. 이런 안정적인 수익이 있으시면 대출받을 때도 훨씬 유리하시고요.

혹시 현재 대출이나 적금 같은 거 하고 계세요?`,

            '40s': `안녕하세요. 대우건설에서 전화드렸는데요.

실투자금 3000만원대로 사무실 한 채 소유하셔서 매달 60만원씩 월세 받아보시라고 연락드렸는데요.

제 말처럼 3000만원대로 매달 60만원씩 월세 나온다고 하시면 좋으신 거 알고 계시죠?

이런 거 한번 알아보시라고 연락드렸는데요.

왜냐하면 지금 목소리 들어보니까 나이대가 40대 정도 같으신데 맞으시죠?

40대시면 자녀 교육비에 노후 준비까지 정말 돈 들어갈 일이 많으시잖아요. 은행 적금 금리로는 인플레이션도 못 따라가시는 상황이고요.

3000만원으로 매달 60만원씩, 연 24% 수익률인데요. 은행 금리보다 훨씬 나으시고, 무엇보다 안정적으로 매달 들어와요.

아이들 학원비나 생활비에 바로바로 보탬이 되실 거예요. 특히 40대는 수입은 정체되는데 지출은 늘어나는 시기잖아요.

이런 부수입이 있으시면 경제적 여유가 훨씬 생기실 거예요.

혹시 현재 다른 투자나 부동산 하고 계신 것 있으세요?`,

            '50s': `안녕하세요. 대우건설에서 전화드렸는데요.

실투자금 3000만원대로 사무실 한 채 소유하셔서 매달 60만원씩 월세 받아보시라고 연락드렸는데요.

제 말처럼 3000만원대로 매달 60만원씩 월세 나온다고 하시면 좋으신 거 알고 계시죠?

이런 거 한번 알아보시라고 연락드렸는데요.

왜냐하면 지금 목소리 들어보니까 나이대가 50대 정도 같으신데 맞으시죠?

50대시면 이제 본격적으로 노후 준비 하셔야 할 나이시잖아요. 국민연금만으로는 부족하시고, 그렇다고 주식은 위험하시고…

이런 안정적인 부동산 월세 수입이 딱 맞으실 것 같은데요. 3000만원으로 매달 60만원씩, 10년만 받으셔도 원금 회수되시고요.

그 이후로는 순수익이에요. 노후 연금처럼 받으실 수 있어요. 50대부터 이런 수익구조를 만들어 놓으시면, 60대 이후가 정말 편하세요.

은퇴 후에도 매달 꼬박꼬박 들어오는 수입이 있으니까 마음의 여유가 생기시죠.

혹시 현재 노후 준비로 뭔가 하고 계신 게 있으세요?`,

            '60s': `안녕하세요. 대우건설에서 전화드렸는데요.

실투자금 3000만원대로 사무실 한 채 소유하셔서 매달 60만원씩 월세 받아보시라고 연락드렸는데요.

제 말처럼 3000만원대로 매달 60만원씩 월세 나온다고 하시면 좋으신 거 알고 계시죠?

이런 거 한번 알아보시라고 연락드렸는데요.

왜냐하면 지금 목소리 들어보니까 나이대가 60대 정도 같으신데 맞으시죠?

60대시면 이제 연금 받으시면서도 부족한 생활비 때문에 고민이 많으실 텐데요. 은행에 돈 넣어둬도 이자가 얼마나 안 되잖아요.

3000만원으로 매달 60만원씩 받으시면, 국민연금에 플러스로 생활비 보탬이 많이 되실 거예요.

병원비나 용돈, 손자손녀들 용돈도 넉넉히 주실 수 있고요. 무엇보다 안전하고 매달 꼬박꼬박 들어오니까 마음도 편하세요.

60대 이후에는 안정성이 가장 중요한데, 이 투자는 정말 안전하면서도 수익도 괜찮거든요.

혹시 지금 정기예금이나 적금 같은 거 하고 계세요?`,

            '70s': `안녕하세요. 대우건설에서 전화드렸는데요.

실투자금 3000만원대로 사무실 한 채 소유하셔서 매달 60만원씩 월세 받아보시라고 연락드렸는데요.

제 말처럼 3000만원대로 매달 60만원씩 월세 나온다고 하시면 좋으신 거 알고 계시죠?

이런 거 한번 알아보시라고 연락드렸는데요.

왜냐하면 지금 목소리 들어보니까 나이대가 70대 정도 같으신데 맞으시죠?

어르신들은 무엇보다 안전한 게 최우선이시잖아요. 이것도 정부에서 관리하는 건물이라 안전하시고요.

3000만원으로 매달 60만원씩 받으시면, 연금 외에 용돈으로 딱 좋으세요. 자식들한테 손 벌리지 않으시고 당당하게 생활하실 수 있고요.

병원비나 약값도 걱정 없으시고, 손자손녀들 용돈도 넉넉히 주실 수 있어요.

연세 있으신 분들은 복잡한 투자보다는 이렇게 간단하고 안전한 게 최고세요. 매달 통장에 입금되니까 관리도 편하시고요.

혹시 지금 은행에 목돈 넣어두고 계신 것 있으세요?`
        };

        // 상황별 대응 스크립트
        const situationScripts = {
            busy: `아, 바쁘시구나. 그럼 간단하게만 말씀드릴게요.

3000만원으로 매달 60만원씩 받는 거니까, 1년이면 720만원이에요.
정말 좋은 투자 기회라서 한번만 알아보시면 좋겠는데요.

혹시 언제쯤 시간 되시면 3분만 자세히 설명드려도 될까요?`,

            okay: `네, 관심 가져주셔서 감사합니다.

그럼 자세히 설명드릴게요. 이게 대우건설에서 직접 분양하는 사무실인데요.
서울 강남구에 위치해 있고, 정부에서 보증하는 임대수익형 부동산이에요.

3000만원 투자하시면 매달 60만원씩, 연간 720만원의 안정적인 수익이 나와요.
이 정도 수익률이면 은행 금리의 몇 배 되시죠?

혹시 이런 투자 경험 있으셔서 이해하고 계신 건가요?`,

            text: `아, 문자로 받아보고 싶으시다구요?

그럼 지금 말씀드린 내용이랑 자료를 문자로 보내드릴게요.
번호가 010으로 시작하는 번호 맞으시죠?

문자 보내드리면 꼭 한번 확인해보시고, 궁금한 거 있으시면 언제든지 연락주세요.
이런 좋은 기회가 자주 있는 건 아니거든요.

그럼 문자로 자세한 정보 보내드릴게요.`,

            unknown: `아, 잘 모르시겠다구요? 이해할 수 있어요.

간단하게 설명드리면, 3000만원 투자해서 매달 60만원씩 받는 거예요.
마치 은행에 돈 넣어두고 이자 받는 것처럼, 매달 꼬박꼬박 들어와요.

다른 복잡한 투자랑 달리, 이건 정말 안전하고 간단해요.
정부에서 보증하는 부동산이라 위험하지도 않고요.

혹시 지금 은행에 예금 같은 거 하고 계세요? 그거랑 비슷한데 수익이 훨씬 좋아요.`
        };

        // 연령대별 스크립트 적용 함수
        function applyAgeScript(age, buttonElement) {
            const investment = investmentInput.value || '3000만원';
            const monthlyRent = monthlyRentInput.value || '60만원';
            
            let script = ageScripts[age] || ageScripts.basic;
            
            // 투자금액과 월세금액을 스크립트에 반영
            script = script.replace(/3000만원/g, investment);
            script = script.replace(/60만원/g, monthlyRent);
            
            scriptEditor.value = script;
            prompterText.textContent = script;
            
            // 모든 연령대 버튼의 active 클래스 제거
            document.querySelectorAll('.age-btn').forEach(btn => btn.classList.remove('active'));
            
            // 클릭된 버튼에 active 클래스 추가
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // 드롭다운도 동기화
            ageGroupSelect.value = age;
            
            // 스크롤 위치 리셋
            currentPosition = 0;
            prompterText.style.transform = 'translateY(0px)';
            
            syncIndicator.innerHTML = `<span>✅ ${age === 'basic' ? '기본' : age.replace('s', '대')} 스크립트 적용됨</span>`;
        }

        // 상황별 대응 스크립트 적용 함수
        function applySituationScript(situation, buttonElement) {
            const script = situationScripts[situation];
            if (script) {
                scriptEditor.value = script;
                prompterText.textContent = script;
                
                // 모든 상황 버튼의 active 클래스 제거
                document.querySelectorAll('.situation-btn').forEach(btn => btn.classList.remove('active'));
                
                // 클릭된 버튼에 active 클래스 추가
                if (buttonElement) {
                    buttonElement.classList.add('active');
                }
                
                // 스크롤 위치 리셋
                currentPosition = 0;
                prompterText.style.transform = 'translateY(0px)';
                
                let situationName = '';
                switch(situation) {
                    case 'busy': situationName = '바빠요'; break;
                    case 'okay': situationName = '괜찮아요'; break;
                    case 'text': situationName = '문자주세요'; break;
                    case 'unknown': situationName = '모르겠어요'; break;
                }
                
                syncIndicator.innerHTML = `<span>✅ "${situationName}" 대응 스크립트 적용됨</span>`;
            }
        }

        // 음성 인식 설정
        function initVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('이 브라우저는 음성 인식을 지원하지 않습니다.\nChrome, Edge 브라우저를 사용해주세요.');
                return false;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'ko-KR';
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                recordingIndicator.style.display = 'flex';
                syncIndicator.innerHTML = '<span>🎤 음성 인식 시작됨</span>';
                console.log('음성 인식이 시작되었습니다.');
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                if (finalTranscript) {
                    recognizedText += finalTranscript;
                    console.log('인식된 최종 텍스트:', finalTranscript);
                    syncWithSpeech(finalTranscript);
                    syncIndicator.innerHTML = '<span>🎯 음성 동기화: ' + finalTranscript.substring(0, 20) + '...</span>';
                } else if (interimTranscript) {
                    console.log('임시 인식 텍스트:', interimTranscript);
                    syncIndicator.innerHTML = '<span>🎤 듣는 중: ' + interimTranscript.substring(0, 20) + '...</span>';
                }
            };

            recognition.onerror = (event) => {
                console.log('음성 인식 오류:', event.error);
                let errorMsg = '';
                switch(event.error) {
                    case 'not-allowed':
                        errorMsg = '마이크 권한이 거부되었습니다.';
                        break;
                    case 'no-speech':
                        errorMsg = '음성이 감지되지 않습니다.';
                        break;
                    case 'audio-capture':
                        errorMsg = '마이크에 접근할 수 없습니다.';
                        break;
                    case 'network':
                        errorMsg = '네트워크 오류가 발생했습니다.';
                        break;
                    default:
                        errorMsg = '음성 인식 오류: ' + event.error;
                }
                syncIndicator.innerHTML = '<span>❌ ' + errorMsg + '</span>';
                
                // 오류 후 3초 뒤 자동 재시작
                if (isVoiceRecognition && event.error !== 'not-allowed') {
                    setTimeout(() => {
                        if (isVoiceRecognition) {
                            try {
                                recognition.start();
                            } catch (e) {
                                console.error('음성 인식 재시작 실패:', e);
                            }
                        }
                    }, 3000);
                }
            };

            recognition.onend = () => {
                console.log('음성 인식이 종료되었습니다.');
                if (isVoiceRecognition) {
                    setTimeout(() => {
                        try {
                            recognition.start(); // 자동 재시작
                        } catch (e) {
                            console.error('음성 인식 재시작 실패:', e);
                        }
                    }, 100);
                } else {
                    recordingIndicator.style.display = 'none';
                    syncIndicator.innerHTML = '<span>🔄 동기화 준비</span>';
                }
            };

            return true;
        }

        // 음성과 텍스트 동기화
        function syncWithSpeech(spokenText) {
            const scriptText = scriptEditor.value.toLowerCase();
            const spokenWords = spokenText.toLowerCase().trim().split(/\s+/);
            scriptWords = scriptText.split(/\s+/);
            
            // 현재 말한 단어들이 스크립트의 어느 부분에 해당하는지 찾기
            for (let i = 0; i < scriptWords.length - spokenWords.length + 1; i++) {
                let match = true;
                for (let j = 0; j < spokenWords.length; j++) {
                    if (!scriptWords[i + j] || !scriptWords[i + j].toLowerCase().includes(spokenWords[j].substring(0, 3))) {
                        match = false;
                        break;
                    }
                }
                if (match) {
                    currentWordIndex = i + spokenWords.length;
                    adjustScrollPosition();
                    
                    // 말하기 속도 계산 및 스크롤 속도 조정
                    const now = Date.now();
                    const timeDiff = (now - lastSpeechTime) / 1000; // 초
                    if (timeDiff > 0) {
                        speechRate = spokenWords.length / timeDiff;
                        autoAdjustScrollSpeed();
                    }
                    lastSpeechTime = now;
                    break;
                }
            }
        }

        // 스크롤 위치 조정
        function adjustScrollPosition() {
            if (currentWordIndex > 0 && scriptWords.length > 0) {
                const progress = currentWordIndex / scriptWords.length;
                const totalHeight = prompterText.scrollHeight;
                const targetPosition = progress * totalHeight * 0.6; // 60% 정도로 조정
                currentPosition = targetPosition;
                prompterText.style.transform = `translateY(-${currentPosition}px)`;
                
                console.log(`스크롤 위치 조정: ${currentWordIndex}/${scriptWords.length} words (${Math.round(progress * 100)}%)`);
            }
        }

        // 자동 스크롤 속도 조정
        function autoAdjustScrollSpeed() {
            if (speechRate > 0) {
                // 말하기 속도에 따라 스크롤 속도 자동 조정
                let newSpeed = Math.max(1, Math.min(10, Math.round(speechRate * 2)));
                scrollSpeed = newSpeed;
                speedSlider.value = newSpeed;
                currentSpeedDisplay.textContent = newSpeed;
                
                console.log(`자동 속도 조정: ${speechRate.toFixed(2)} 단어/초 -> 속도 ${newSpeed}`);
            }
        }

        // 모바일 디바이스 감지
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // 마이크 권한 요청
        function requestMicrophonePermission() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                return navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        // 권한 획득 후 스트림 정리
                        stream.getTracks().forEach(track => track.stop());
                        return true;
                    })
                    .catch(error => {
                        console.error('마이크 권한 오류:', error);
                        return false;
                    });
            }
            return Promise.resolve(false);
        }

        // 이벤트 리스너 설정
        autoScrollBtn.addEventListener('click', () => {
            isAutoScrolling = !isAutoScrolling;
            autoScrollBtn.textContent = isAutoScrolling ? '정지' : '시작';
            autoScrollBtn.classList.toggle('active', isAutoScrolling);
            
            if (isAutoScrolling) {
                startAutoScroll();
                syncIndicator.innerHTML = '<span>▶️ 자동 스크롤 중</span>';
            } else {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
                syncIndicator.innerHTML = '<span>⏸️ 스크롤 정지</span>';
            }
        });

        speedSlider.addEventListener('input', (e) => {
            scrollSpeed = parseInt(e.target.value);
            currentSpeedDisplay.textContent = scrollSpeed;
        });

        fontSizeSelect.addEventListener('change', (e) => {
            prompterText.style.fontSize = e.target.value + 'px';
        });

        mirrorBtn.addEventListener('click', () => {
            isMirrorMode = !isMirrorMode;
            mirrorBtn.textContent = isMirrorMode ? 'ON' : 'OFF';
            mirrorBtn.classList.toggle('active', isMirrorMode);
            prompterContainer.classList.toggle('mirror-mode', isMirrorMode);
        });

        voiceBtn.addEventListener('click', async () => {
            // 모바일에서 마이크 권한 미리 확인
            if (isMobileDevice() && !recognition) {
                syncIndicator.innerHTML = '<span>🎤 마이크 권한 확인 중...</span>';
                const hasPermission = await requestMicrophonePermission();
                if (!hasPermission) {
                    syncIndicator.innerHTML = '<span>❌ 마이크 권한이 필요합니다</span>';
                    alert('음성 인식을 사용하려면 마이크 권한을 허용해주세요.');
                    return;
                }
            }

            if (!recognition) {
                const initialized = initVoiceRecognition();
                if (!initialized) return;
            }
            
            isVoiceRecognition = !isVoiceRecognition;
            voiceBtn.textContent = isVoiceRecognition ? '정지' : '시작';
            voiceBtn.classList.toggle('active', isVoiceRecognition);
            
            if (isVoiceRecognition) {
                syncIndicator.innerHTML = '<span>🎤 음성 인식 준비 중...</span>';
                
                try {
                    recognition.start();
                    recognizedText = '';
                    currentWordIndex = 0;
                    lastSpeechTime = Date.now();
                    
                    // 모바일에서 진동 피드백
                    if (navigator.vibrate && isMobileDevice()) {
                        navigator.vibrate(100);
                    }
                } catch (error) {
                    console.error('음성 인식 시작 실패:', error);
                    isVoiceRecognition = false;
                    voiceBtn.textContent = '시작';
                    voiceBtn.classList.remove('active');
                    syncIndicator.innerHTML = '<span>❌ 음성 인식 시작 실패</span>';
                }
            } else {
                try {
                    recognition.stop();
                    if (navigator.vibrate && isMobileDevice()) {
                        navigator.vibrate(50);
                    }
                } catch (error) {
                    console.error('음성 인식 정지 실패:', error);
                }
            }
        });

        resetBtn.addEventListener('click', () => {
            currentPosition = 0;
            prompterText.style.transform = 'translateY(0px)';
            syncIndicator.innerHTML = '<span>🔄 위치 리셋</span>';
        });

        scriptEditor.addEventListener('input', (e) => {
            prompterText.textContent = e.target.value;
            // 대본이 변경될 때마다 단어 배열 업데이트
            scriptWords = e.target.value.toLowerCase().split(/\s+/);
            currentWordIndex = 0; // 인덱스 초기화
        });

        // 연령대 선택 드롭다운
        ageGroupSelect.addEventListener('change', (e) => {
            applyAgeScript(e.target.value, null);
        });

        // 연령대 바로가기 버튼들
        age20Btn.addEventListener('click', () => applyAgeScript('20s', age20Btn));
        age30Btn.addEventListener('click', () => applyAgeScript('30s', age30Btn));
        age40Btn.addEventListener('click', () => applyAgeScript('40s', age40Btn));
        age50Btn.addEventListener('click', () => applyAgeScript('50s', age50Btn));
        age60Btn.addEventListener('click', () => applyAgeScript('60s', age60Btn));
        age70Btn.addEventListener('click', () => applyAgeScript('70s', age70Btn));

        // 상황별 대응 버튼들
        busyBtn.addEventListener('click', () => applySituationScript('busy', busyBtn));
        okayBtn.addEventListener('click', () => applySituationScript('okay', okayBtn));
        textBtn.addEventListener('click', () => applySituationScript('text', textBtn));
        unknownBtn.addEventListener('click', () => applySituationScript('unknown', unknownBtn));

        // 투자금액/월세금액 변경 시 자동 업데이트
        investmentInput.addEventListener('input', () => {
            const currentAge = ageGroupSelect.value;
            if (currentAge !== 'basic') {
                applyAgeScript(currentAge, document.querySelector('.age-btn.active'));
            }
        });

        monthlyRentInput.addEventListener('input', () => {
            const currentAge = ageGroupSelect.value;
            if (currentAge !== 'basic') {
                applyAgeScript(currentAge, document.querySelector('.age-btn.active'));
            }
        });

        // 리모컨 버튼
        remoteUp.addEventListener('click', () => {
            currentPosition = Math.max(0, currentPosition - 50);
            prompterText.style.transform = `translateY(-${currentPosition}px)`;
        });

        remotePause.addEventListener('click', () => {
            autoScrollBtn.click();
        });

        remoteDown.addEventListener('click', () => {
            currentPosition += 50;
            prompterText.style.transform = `translateY(-${currentPosition}px)`;
        });

        // 키보드 단축키
        document.addEventListener('keydown', (e) => {
            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    autoScrollBtn.click();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    remoteUp.click();
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    remoteDown.click();
                    break;
                case 'KeyR':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        resetBtn.click();
                    }
                    break;
                case 'KeyV':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        voiceBtn.click();
                    }
                    break;
                // Ctrl + 숫자 키패드로 연령대 바로 적용
                case 'Digit1':
                case 'Numpad1':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        applyAgeScript('basic', null);
                    }
                    break;
                case 'Digit2':
                case 'Numpad2':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        applyAgeScript('20s', age20Btn);
                    }
                    break;
                case 'Digit3':
                case 'Numpad3':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        applyAgeScript('30s', age30Btn);
                    }
                    break;
                case 'Digit4':
                case 'Numpad4':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        applyAgeScript('40s', age40Btn);
                    }
                    break;
                case 'Digit5':
                case 'Numpad5':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        applyAgeScript('50s', age50Btn);
                    }
                    break;
                case 'Digit6':
                case 'Numpad6':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        applyAgeScript('60s', age60Btn);
                    }
                    break;
                case 'Digit7':
                case 'Numpad7':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        applyAgeScript('70s', age70Btn);
                    }
                    break;
                // 상황별 대응 단축키
                case 'KeyB':
                    if (!e.ctrlKey) {
                        e.preventDefault();
                        applySituationScript('busy', busyBtn);
                    }
                    break;
                case 'KeyO':
                    if (!e.ctrlKey) {
                        e.preventDefault();
                        applySituationScript('okay', okayBtn);
                    }
                    break;
                case 'KeyT':
                    if (!e.ctrlKey) {
                        e.preventDefault();
                        applySituationScript('text', textBtn);
                    }
                    break;
                case 'KeyU':
                    if (!e.ctrlKey) {
                        e.preventDefault();
                        applySituationScript('unknown', unknownBtn);
                    }
                    break;
            }
        });

        // 마우스 휠로 스크롤 제어 (데스크톱)
        prompterContainer.addEventListener('wheel', (e) => {
            e.preventDefault();
            if (e.deltaY > 0) {
                currentPosition += 30;
            } else {
                currentPosition = Math.max(0, currentPosition - 30);
            }
            prompterText.style.transform = `translateY(-${currentPosition}px)`;
        });

        // 터치 이벤트 처리 (모바일/태블릿)
        let touchStartY = 0;
        let touchStartTime = 0;
        let isScrollingByTouch = false;

        prompterContainer.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
            touchStartTime = Date.now();
            isScrollingByTouch = true;
        }, { passive: true });

        prompterContainer.addEventListener('touchmove', (e) => {
            if (!isScrollingByTouch) return;
            
            const touchY = e.touches[0].clientY;
            const deltaY = touchStartY - touchY;
            
            // 스크롤 방향에 따라 위치 조정
            currentPosition += deltaY * 0.5;
            currentPosition = Math.max(0, currentPosition);
            prompterText.style.transform = `translateY(-${currentPosition}px)`;
            
            touchStartY = touchY;
        }, { passive: true });

        prompterContainer.addEventListener('touchend', () => {
            isScrollingByTouch = false;
        }, { passive: true });

        // 더블 탭으로 자동 스크롤 토글
        let lastTouchTime = 0;
        prompterContainer.addEventListener('touchend', (e) => {
            const currentTime = Date.now();
            if (currentTime - lastTouchTime < 300) {
                // 더블 탭 감지
                autoScrollBtn.click();
                e.preventDefault();
            }
            lastTouchTime = currentTime;
        });

        // 화면 방향 변경 감지
        function handleOrientationChange() {
            // 화면 방향 변경 시 레이아웃 재조정
            setTimeout(() => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }, 100);
        }

        // iOS Safari 뷰포트 높이 문제 해결
        function setVhProperty() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        // 모바일 브라우저 주소창 숨김 감지
        window.addEventListener('resize', handleOrientationChange);
        window.addEventListener('orientationchange', handleOrientationChange);
        
        // 페이지 로드 시 뷰포트 높이 설정
        setVhProperty();

        // 초기화
        document.addEventListener('DOMContentLoaded', () => {
            syncIndicator.innerHTML = '<span>✅ 시스템 준비 완료</span>';
            
            // 초기 스크립트 설정
            const initialScript = `도입
“네“  안녕하세요
대우건설에서 전화드렸는데요 실 투자금 3천만 원대로 사무실 한 채 소유하셔서 매달 60만 원씩 월세 받아보시라고 연락드렸어요↓

만약에 제 말처럼 3천만 원대로 매달 60만 원씩 
월세 나온다고 하면 좋으신 건 알고 계시죠→
(2초정도 답변을 기다린다. )

이런 거 한번 알아보시라고 
연락드렸는데 지금 목소리 들어보니니까 
나이 ~ 대가 00대 정도 같으신데 맞으시죠?`;
            
            if (scriptEditor.value.trim() === '') {
                scriptEditor.value = initialScript;
                prompterText.textContent = initialScript;
            }
        });
    </script>
</body>
</html>