<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŒì„± ì¸ì‹ í…ìŠ¤íŠ¸ ë³€í™˜ê¸°</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
    .container {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    h1 {
        text-align: center;
        color: #4a5568;
        margin-bottom: 30px;
        font-size: 2.5em;
    }

    .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 50px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 140px;
        justify-content: center;
    }

    .btn-start {
        background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        color: white;
    }

    .btn-start:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
    }

    .btn-stop {
        background: linear-gradient(45deg, #4ecdc4, #44a08d);
        color: white;
    }

    .btn-stop:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
    }

    .btn-clear {
        background: linear-gradient(45deg, #feca57, #ff9ff3);
        color: white;
    }

    .btn-clear:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(254, 202, 87, 0.4);
    }

    .btn-save {
        background: linear-gradient(45deg, #5f27cd, #341f97);
        color: white;
    }

    .btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(95, 39, 205, 0.4);
    }

    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .status {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        border-radius: 10px;
        font-weight: bold;
        transition: all 0.3s ease;
    }

    .status.listening {
        background: linear-gradient(45deg, #ff6b6b, #feca57);
        color: white;
        animation: pulse 2s infinite;
    }

    .status.stopped {
        background: #f8f9fa;
        color: #6c757d;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .text-area {
        width: 100%;
        min-height: 300px;
        padding: 20px;
        border: 2px solid #e9ecef;
        border-radius: 15px;
        font-size: 18px;
        line-height: 1.6;
        resize: vertical;
        font-family: 'Arial', sans-serif;
        box-sizing: border-box;
    }

    .text-area:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .info {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        font-size: 14px;
        color: #1565c0;
    }

    .mic-icon {
        font-size: 18px;
    }

    .word-count {
        text-align: right;
        color: #6c757d;
        font-size: 14px;
        margin-top: 10px;
    }

    .save-options {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .filename-input {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        min-width: 200px;
    }

    .filename-input:focus {
        outline: none;
        border-color: #667eea;
    }

    .success-message {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 10px;
        border-radius: 8px;
        margin-top: 10px;
        text-align: center;
        display: none;
    }
</style>

</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ìŒì„± ì¸ì‹ í…ìŠ¤íŠ¸ ë³€í™˜ê¸°</h1>
    
    <div class="controls">
        <button id="startBtn" class="btn btn-start">
            <span class="mic-icon">ğŸ¤</span>
            ìŒì„± ì¸ì‹ ì‹œì‘
        </button>
        <button id="stopBtn" class="btn btn-stop" disabled>
            <span>â¹ï¸</span>
            ì¸ì‹ ì¤‘ì§€
        </button>
        <button id="clearBtn" class="btn btn-clear">
            <span>ğŸ—‘ï¸</span>
            í…ìŠ¤íŠ¸ ì§€ìš°ê¸°
        </button>
        <button id="saveBtn" class="btn btn-save">
            <span>ğŸ’¾</span>
            íŒŒì¼ë¡œ ì €ì¥
        </button>
    </div>

    <div class="save-options">
        <label for="filenameInput">íŒŒì¼ëª…:</label>
        <input type="text" id="filenameInput" class="filename-input" placeholder="ìŒì„±ë©”ëª¨" value="ìŒì„±ë©”ëª¨">
        <small style="color: #6c757d;">.txt íŒŒì¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤</small>
    </div>

    <div id="successMessage" class="success-message">
        íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“
    </div>

    <div id="status" class="status stopped">
        ìŒì„± ì¸ì‹ì„ ì‹œì‘í•˜ë ¤ë©´ "ìŒì„± ì¸ì‹ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
    </div>

    <textarea id="textArea" class="text-area" placeholder="ì—¬ê¸°ì— ìŒì„±ìœ¼ë¡œ ë³€í™˜ëœ í…ìŠ¤íŠ¸ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤..."></textarea>
    
    <div class="word-count">
        ê¸€ì ìˆ˜: <span id="charCount">0</span>ì | ë‹¨ì–´ ìˆ˜: <span id="wordCount">0</span>ê°œ
    </div>

    <div class="info">
        <strong>ì‚¬ìš© ë°©ë²•:</strong><br>
        1. "ìŒì„± ì¸ì‹ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”<br>
        2. ë§ˆì´í¬ ì ‘ê·¼ì„ í—ˆìš©í•˜ì„¸ìš”<br>
        3. ìì—°ìŠ¤ëŸ½ê²Œ ë§í•˜ë©´ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ë©ë‹ˆë‹¤<br>
        4. "ì¸ì‹ ì¤‘ì§€" ë²„íŠ¼ìœ¼ë¡œ ì¤‘ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
        5. "íŒŒì¼ë¡œ ì €ì¥" ë²„íŠ¼ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë©”ëª¨ì¥ íŒŒì¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤<br><br>
        <strong>ì°¸ê³ :</strong> ì´ ê¸°ëŠ¥ì€ Chrome, Edge ë“± ìµœì‹  ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›ë©ë‹ˆë‹¤.
    </div>
</div>

<script>
    // ìŒì„± ì¸ì‹ API í™•ì¸
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        document.getElementById('status').textContent = 'ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”.';
        document.getElementById('startBtn').disabled = true;
    } else {
        // ìŒì„± ì¸ì‹ ê°ì²´ ìƒì„±
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();

        // ìŒì„± ì¸ì‹ ì„¤ì •
        recognition.continuous = true; // ì§€ì†ì ìœ¼ë¡œ ì¸ì‹
        recognition.interimResults = true; // ì¤‘ê°„ ê²°ê³¼ë„ í‘œì‹œ
        recognition.lang = 'ko-KR'; // í•œêµ­ì–´ ì„¤ì •

        // DOM ìš”ì†Œë“¤
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const saveBtn = document.getElementById('saveBtn');
        const status = document.getElementById('status');
        const textArea = document.getElementById('textArea');
        const charCount = document.getElementById('charCount');
        const wordCount = document.getElementById('wordCount');
        const filenameInput = document.getElementById('filenameInput');
        const successMessage = document.getElementById('successMessage');

        let isRecognizing = false;
        let finalTranscript = '';

        // ê¸€ì ìˆ˜ ë° ë‹¨ì–´ ìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCounts() {
            const text = textArea.value;
            charCount.textContent = text.length;
            wordCount.textContent = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
        }

        // íŒŒì¼ ì €ì¥ í•¨ìˆ˜
        function saveToFile() {
            const text = textArea.value.trim();
            
            if (text === '') {
                alert('ì €ì¥í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const filename = filenameInput.value.trim() || 'ìŒì„±ë©”ëª¨';
            const currentDate = new Date();
            const dateString = currentDate.toLocaleDateString('ko-KR').replace(/\./g, '').replace(/ /g, '');
            const timeString = currentDate.toLocaleTimeString('ko-KR', {hour12: false}).replace(/:/g, '');
            const fullFilename = `${filename}_${dateString}_${timeString}.txt`;

            // Blob ìƒì„± (UTF-8 BOM ì¶”ê°€ë¡œ í•œê¸€ ê¹¨ì§ ë°©ì§€)
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + text], { type: 'text/plain;charset=utf-8' });

            // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fullFilename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        // ìŒì„± ì¸ì‹ ì‹œì‘
        startBtn.addEventListener('click', () => {
            if (!isRecognizing) {
                recognition.start();
                isRecognizing = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                status.textContent = 'ìŒì„± ì¸ì‹ ì¤‘... ë§ì”€í•´ì£¼ì„¸ìš”';
                status.className = 'status listening';
            }
        });

        // ìŒì„± ì¸ì‹ ì¤‘ì§€
        stopBtn.addEventListener('click', () => {
            if (isRecognizing) {
                recognition.stop();
                isRecognizing = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
                status.textContent = 'ìŒì„± ì¸ì‹ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤';
                status.className = 'status stopped';
            }
        });

        // í…ìŠ¤íŠ¸ ì§€ìš°ê¸°
        clearBtn.addEventListener('click', () => {
            textArea.value = '';
            finalTranscript = '';
            updateCounts();
        });

        // íŒŒì¼ ì €ì¥
        saveBtn.addEventListener('click', saveToFile);

        // ìŒì„± ì¸ì‹ ê²°ê³¼ ì²˜ë¦¬
        recognition.addEventListener('result', (event) => {
            let interimTranscript = '';
            
            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                
                if (event.results[i].isFinal) {
                    finalTranscript += transcript + ' ';
                } else {
                    interimTranscript += transcript;
                }
            }
            
            textArea.value = finalTranscript + interimTranscript;
            updateCounts();
            
            // ìë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            textArea.scrollTop = textArea.scrollHeight;
        });

        // ìŒì„± ì¸ì‹ ì‹œì‘ ì´ë²¤íŠ¸
        recognition.addEventListener('start', () => {
            status.textContent = 'ìŒì„± ì¸ì‹ ì¤‘... ë§ì”€í•´ì£¼ì„¸ìš”';
            status.className = 'status listening';
        });

        // ìŒì„± ì¸ì‹ ì¢…ë£Œ ì´ë²¤íŠ¸
        recognition.addEventListener('end', () => {
            if (isRecognizing) {
                // ìë™ìœ¼ë¡œ ì¬ì‹œì‘ (ì—°ì† ì¸ì‹ì„ ìœ„í•´)
                setTimeout(() => {
                    if (isRecognizing) {
                        recognition.start();
                    }
                }, 100);
            } else {
                status.textContent = 'ìŒì„± ì¸ì‹ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤';
                status.className = 'status stopped';
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }
        });

        // ì˜¤ë¥˜ ì²˜ë¦¬
        recognition.addEventListener('error', (event) => {
            console.error('ìŒì„± ì¸ì‹ ì˜¤ë¥˜:', event.error);
            
            if (event.error === 'not-allowed') {
                status.textContent = 'ë§ˆì´í¬ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
            } else if (event.error === 'no-speech') {
                status.textContent = 'ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            } else {
                status.textContent = `ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ${event.error}`;
            }
            
            status.className = 'status stopped';
            isRecognizing = false;
            startBtn.disabled = false;
            stopBtn.disabled = true;
        });

        // í…ìŠ¤íŠ¸ ì˜ì—­ ë³€ê²½ ì‹œ ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
        textArea.addEventListener('input', updateCounts);

        // íŒŒì¼ëª… ì…ë ¥ë€ì—ì„œ Enter í‚¤ ëˆŒë €ì„ ë•Œ ì €ì¥
        filenameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveToFile();
            }
        });

        // ì´ˆê¸° ê¸€ì ìˆ˜ ì„¤ì •
        updateCounts();
    }
</script>
</body>
</html>