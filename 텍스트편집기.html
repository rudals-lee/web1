<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>텍스트 처리기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        function clearAll() {
            inputText.value = '';
            resultText.innerHTML = '';
            fileInfo.innerHTML = '';
            stats.innerHTML = '';
            resultSection.style.display = 'none';
            highlightControls.style.display = 'none';
            highlightList.style.display = 'none';
            printSettings.style.display = 'none';
            downloadBtn.style.display = 'none';
            originalText = '';
            processedText = '';
            highlights = [];
            finalHTML = '';
            fileInput.value = '';
            document.getElementById('highlightText').value = '';
        }

    // Enter 키로 강조 추가
    document.getElementById('highlightText').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            addHighlight();
        }
    });

    body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 2.2em;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .upload-section {
        margin-bottom: 30px;
    }

    .upload-area {
        border: 3px dashed #667eea;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        background: rgba(102, 126, 234, 0.05);
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .upload-area:hover {
        border-color: #764ba2;
        background: rgba(118, 75, 162, 0.05);
        transform: translateY(-2px);
    }

    .upload-area.dragover {
        border-color: #764ba2;
        background: rgba(118, 75, 162, 0.1);
        transform: scale(1.02);
    }

    .upload-icon {
        font-size: 3em;
        margin-bottom: 15px;
        color: #667eea;
    }

    .file-input {
        display: none;
    }

    .upload-text {
        color: #666;
        font-size: 1.1em;
        margin-bottom: 15px;
    }

    .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s ease;
        margin: 5px;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .text-input {
        width: 100%;
        min-height: 150px;
        padding: 20px;
        border: 2px solid #e1e5e9;
        border-radius: 15px;
        font-size: 1em;
        font-family: 'Courier New', monospace;
        resize: vertical;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.8);
    }

    .text-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
    }

    .result-section {
        margin-top: 30px;
        padding: 25px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 15px;
        border: 1px solid rgba(102, 126, 234, 0.2);
    }

    .result-text {
        width: 100%;
        min-height: 150px;
        padding: 20px;
        border: 2px solid #e1e5e9;
        border-radius: 15px;
        font-size: 1em;
        font-family: 'Courier New', monospace;
        resize: vertical;
        background: #f8f9fa;
        color: #333;
    }

    .controls {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .highlight-controls {
        background: rgba(255, 255, 255, 0.8);
        padding: 20px;
        border-radius: 15px;
        margin: 20px 0;
        border: 2px solid rgba(102, 126, 234, 0.2);
    }

    .highlight-row {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .highlight-input {
        flex: 1;
        min-width: 200px;
        padding: 8px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 0.9em;
    }

    .color-picker {
        width: 50px;
        height: 40px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .highlight-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s ease;
    }

    .highlight-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    .highlight-btn.remove {
        background: linear-gradient(45deg, #ff6b6b, #ff5722);
    }

    .highlight-list {
        max-height: 200px;
        overflow-y: auto;
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
    }

    .highlight-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px;
        margin-bottom: 8px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .highlight-preview {
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: bold;
        flex: 1;
    }

    .print-settings {
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 15px;
        margin: 20px 0;
        border: 2px solid rgba(102, 126, 234, 0.2);
        display: none;
    }

    .print-row {
        display: flex;
        gap: 15px;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .print-input {
        flex: 1;
        min-width: 150px;
        padding: 8px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 0.9em;
    }

    .print-select {
        padding: 8px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 0.9em;
        min-width: 120px;
    }

    .print-checkbox {
        margin-right: 8px;
    }

    .print-label {
        font-weight: bold;
        min-width: 100px;
        color: #333;
    }

    .result-text {
        width: 100%;
        min-height: 150px;
        padding: 20px;
        border: 2px solid #e1e5e9;
        border-radius: 15px;
        font-size: 1em;
        font-family: 'Courier New', monospace;
        resize: vertical;
        background: #f8f9fa;
        color: #333;
        white-space: pre-wrap;
    }

    .file-info {
        background: rgba(102, 126, 234, 0.1);
        padding: 10px 20px;
        border-radius: 25px;
        margin: 10px 0;
        color: #667eea;
        font-weight: bold;
        display: inline-block;
    }

    .section-title {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.2em;
        font-weight: bold;
    }

    .stats {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        flex-wrap: wrap;
    }

    .stat-item {
        background: rgba(102, 126, 234, 0.1);
        padding: 8px 16px;
        border-radius: 15px;
        color: #667eea;
        font-size: 0.9em;
    }

    @media (max-width: 600px) {
        .container {
            padding: 20px;
            margin: 10px;
        }
        
        h1 {
            font-size: 1.8em;
        }
        
        .controls {
            flex-direction: column;
            align-items: center;
        }
        
        .btn {
            width: 100%;
            max-width: 200px;
        }
    }
</style>
</head>
<body>
    <div class="container">
        <h1>📝 텍스트 처리기</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            텍스트 파일을 업로드하거나 직접 입력하여 줄바꿈과 마침표를 제거하세요
        </p>
    <div class="upload-section">
        <div class="section-title">📁 파일 업로드</div>
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">📄</div>
            <div class="upload-text">텍스트 파일을 여기에 드래그하거나 클릭하여 선택하세요</div>
            <button class="btn" onclick="document.getElementById('fileInput').click()">파일 선택</button>
            <input type="file" id="fileInput" class="file-input" accept=".txt,.text" />
            <div id="highlightList" class="highlight-list" style="display: none;"></div>
    </div>

    <div class="print-settings" id="printSettings">
        <div class="section-title">🖨️ 인쇄 설정</div>
        
        <div class="print-row">
            <div class="print-label">문서 제목:</div>
            <input type="text" id="docTitle" class="print-input" placeholder="문서 제목을 입력하세요" value="처리된 텍스트 문서" />
        </div>
        
        <div class="print-row">
            <div class="print-label">작성자:</div>
            <input type="text" id="docAuthor" class="print-input" placeholder="작성자 이름" />
        </div>
        
        <div class="print-row">
            <div class="print-label">글꼴 크기:</div>
            <select id="fontSize" class="print-select">
                <option value="10">10pt</option>
                <option value="11">11pt</option>
                <option value="12" selected>12pt</option>
                <option value="14">14pt</option>
                <option value="16">16pt</option>
                <option value="18">18pt</option>
            </select>
        </div>
        
        <div class="print-row">
            <div class="print-label">글꼴:</div>
            <select id="fontFamily" class="print-select">
                <option value="Arial">Arial</option>
                <option value="Times New Roman" selected>Times New Roman</option>
                <option value="Calibri">Calibri</option>
                <option value="맑은 고딕">맑은 고딕</option>
                <option value="나눔고딕">나눔고딕</option>
            </select>
        </div>
        
        <div class="print-row">
            <div class="print-label">줄 간격:</div>
            <select id="lineHeight" class="print-select">
                <option value="1.0">1.0</option>
                <option value="1.15">1.15</option>
                <option value="1.5" selected>1.5</option>
                <option value="2.0">2.0</option>
            </select>
        </div>
        
        <div class="print-row">
            <div class="print-label">문서 형식:</div>
            <select id="docFormat" class="print-select">
                <option value="docx">워드 문서 (.docx)</option>
                <option value="doc">워드 97-2003 (.doc)</option>
                <option value="rtf">서식 있는 텍스트 (.rtf)</option>
            </select>
        </div>
        
        <div class="print-row">
            <div class="print-label">페이지 방향:</div>
            <select id="pageOrientation" class="print-select">
                <option value="portrait" selected>세로</option>
                <option value="landscape">가로</option>
            </select>
        </div>
        
        <div class="print-row">
            <div class="print-label">용지 크기:</div>
            <select id="paperSize" class="print-select">
                <option value="A4" selected>A4</option>
                <option value="Letter">Letter</option>
                <option value="Legal">Legal</option>
            </select>
        </div>
        
        <div class="print-row">
            <div class="print-label">여백:</div>
            <select id="margin" class="print-select">
                <option value="narrow">좁게 (1.27cm)</option>
                <option value="normal" selected>보통 (2.54cm)</option>
                <option value="wide">넓게 (3.81cm)</option>
            </select>
        </div>
        
        <div class="print-row">
            <label>
                <input type="checkbox" id="includeDate" class="print-checkbox" checked />
                <span>작성 날짜 포함</span>
            </label>
            <label>
                <input type="checkbox" id="includeStats" class="print-checkbox" />
                <span>텍스트 통계 포함</span>
            </label>
            <label>
                <input type="checkbox" id="includePageNumbers" class="print-checkbox" />
                <span>페이지 번호 포함</span>
            </label>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="generateWordDocument()">📄 워드 문서 생성</button>
            <button class="btn" onclick="previewDocument()">👁️ 미리보기</button>
            <button class="btn" onclick="togglePrintSettings()">❌ 설정 닫기</button>
        </div>
    </div>
        <div id="fileInfo"></div>
    </div>

    <div class="upload-section">
        <div class="section-title">✏️ 직접 입력</div>
        <textarea 
            id="inputText" 
            class="text-input" 
            placeholder="여기에 텍스트를 직접 입력하세요..."
        ></textarea>
    </div>

    <div class="controls">
        <button class="btn" onclick="processText()">🔄 텍스트 처리</button>
        <button class="btn" onclick="clearAll()">🗑️ 모두 지우기</button>
        <button class="btn" onclick="downloadResult()" id="downloadBtn" style="display: none;">💾 결과 다운로드</button>
    </div>

    <div class="highlight-controls" id="highlightControls" style="display: none;">
        <div class="section-title">🎨 텍스트 강조 및 색깔</div>
        
        <div class="highlight-row">
            <input type="text" id="highlightText" class="highlight-input" placeholder="강조할 단어나 문장을 입력하세요" />
            <input type="color" id="highlightColor" class="color-picker" value="#ffff00" title="강조 색상 선택" />
            <button class="highlight-btn" onclick="addHighlight()">➕ 추가</button>
            <button class="highlight-btn" onclick="applyHighlights()">🎨 적용</button>
            <button class="highlight-btn remove" onclick="clearHighlights()">🗑️ 모든 강조 제거</button>
        </div>
        
    .remove-highlight {
        background: #ff6b6b;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8em;
    }

    .print-settings {
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 15px;
        margin: 20px 0;
        border: 2px solid rgba(102, 126, 234, 0.2);
        display: none;
    }

    .print-row {
        display: flex;
        gap: 15px;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .print-input {
        flex: 1;
        min-width: 150px;
        padding: 8px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 0.9em;
    }

    .print-select {
        padding: 8px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 0.9em;
        min-width: 120px;
    }

    .print-checkbox {
        margin-right: 8px;
    }

    .print-label {
        font-weight: bold;
        min-width: 100px;
        color: #333;
    }

    <div class="result-section" id="resultSection" style="display: none;">
        <div class="section-title">✅ 처리 결과</div>
        <div id="resultText" class="result-text"></div>
        <div class="stats" id="stats"></div>
        <div class="controls">
            <button class="btn" onclick="copyResult()">📋 복사</button>
            <button class="btn" onclick="copyResultAsHTML()">📋 HTML로 복사</button>
            <button class="btn" onclick="printToWord()">📄 워드로 인쇄</button>
            <button class="btn" onclick="printDocument()">🖨️ 브라우저 인쇄</button>
        </div>
    </div>
</div>

<script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const inputText = document.getElementById('inputText');
    const resultSection = document.getElementById('resultSection');
    const resultText = document.getElementById('resultText');
    const fileInfo = document.getElementById('fileInfo');
    const downloadBtn = document.getElementById('downloadBtn');
    const stats = document.getElementById('stats');
    const highlightControls = document.getElementById('highlightControls');
    const highlightList = document.getElementById('highlightList');
    const printSettings = document.getElementById('printSettings');

    let originalText = '';
    let processedText = '';
    let highlights = [];
    let finalHTML = '';

    // 드래그 앤 드롭 이벤트
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFile(files[0]);
        }
    });

    uploadArea.addEventListener('click', () => {
        fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFile(e.target.files[0]);
        }
    });

    function handleFile(file) {
        if (!file.type.match('text.*')) {
            alert('텍스트 파일만 업로드할 수 있습니다.');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            inputText.value = e.target.result;
            showFileInfo(file);
        };
        reader.readAsText(file, 'UTF-8');
    }

    function showFileInfo(file) {
        const size = (file.size / 1024).toFixed(2);
        fileInfo.innerHTML = `
            <div class="file-info">
                📄 ${file.name} (${size} KB)
            </div>
        `;
    }

    function processText() {
        originalText = inputText.value.trim();
        
        if (!originalText) {
            alert('처리할 텍스트를 입력하거나 파일을 업로드해주세요.');
            return;
        }

        // 줄바꿈 제거 및 마침표 제거
        processedText = originalText
            .replace(/\r?\n/g, ' ')  // 모든 줄바꿈을 공백으로 변환
            .replace(/\./g, '')      // 모든 마침표 제거
            .replace(/\s+/g, ' ')    // 연속된 공백을 하나로 통합
            .trim();                 // 앞뒤 공백 제거

        displayResult(processedText);
        resultSection.style.display = 'block';
        highlightControls.style.display = 'block';
        downloadBtn.style.display = 'inline-block';
        
        showStats();
        
        // 결과 섹션으로 스크롤
        resultSection.scrollIntoView({ behavior: 'smooth' });
    }

    function displayResult(text) {
        finalHTML = text;
        resultText.innerHTML = escapeHtml(text);
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function addHighlight() {
        const text = document.getElementById('highlightText').value.trim();
        const color = document.getElementById('highlightColor').value;
        
        if (!text) {
            alert('강조할 텍스트를 입력해주세요.');
            return;
        }

        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }

        // 중복 확인
        if (highlights.some(h => h.text === text)) {
            alert('이미 추가된 강조 텍스트입니다.');
            return;
        }

        highlights.push({ text, color });
        updateHighlightList();
        
        // 입력 필드 초기화
        document.getElementById('highlightText').value = '';
    }

    function updateHighlightList() {
        if (highlights.length === 0) {
            highlightList.style.display = 'none';
            return;
        }

        highlightList.style.display = 'block';
        highlightList.innerHTML = highlights.map((highlight, index) => `
            <div class="highlight-item">
                <div class="highlight-preview" style="background-color: ${highlight.color}">
                    ${escapeHtml(highlight.text)}
                </div>
                <button class="remove-highlight" onclick="removeHighlight(${index})">✕</button>
            </div>
        `).join('');
    }

    function removeHighlight(index) {
        highlights.splice(index, 1);
        updateHighlightList();
        applyHighlights();
    }

    function clearHighlights() {
        highlights = [];
        updateHighlightList();
        displayResult(processedText);
    }

    function applyHighlights() {
        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }

        let highlightedText = escapeHtml(processedText);
        
        // 긴 텍스트부터 정렬하여 중첩 문제 방지
        const sortedHighlights = [...highlights].sort((a, b) => b.text.length - a.text.length);
        
        sortedHighlights.forEach(highlight => {
            const regex = new RegExp(escapeRegExp(highlight.text), 'gi');
            highlightedText = highlightedText.replace(regex, 
                `<span style="background-color: ${highlight.color}; padding: 2px 4px; border-radius: 3px; font-weight: bold;">${escapeHtml(highlight.text)}</span>`
            );
        });

        finalHTML = highlightedText;
        resultText.innerHTML = highlightedText;
    }

    function printToWord() {
        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }
        togglePrintSettings();
    }

    function togglePrintSettings() {
        const isVisible = printSettings.style.display !== 'none';
        printSettings.style.display = isVisible ? 'none' : 'block';
        if (!isVisible) {
            printSettings.scrollIntoView({ behavior: 'smooth' });
        }
    }

    function generateWordDocument() {
        const title = document.getElementById('docTitle').value || '처리된 텍스트 문서';
        const author = document.getElementById('docAuthor').value || '';
        const fontSize = document.getElementById('fontSize').value;
        const fontFamily = document.getElementById('fontFamily').value;
        const lineHeight = document.getElementById('lineHeight').value;
        const margin = document.getElementById('margin').value;
        const docFormat = document.getElementById('docFormat').value;
        const pageOrientation = document.getElementById('pageOrientation').value;
        const paperSize = document.getElementById('paperSize').value;
        const includeDate = document.getElementById('includeDate').checked;
        const includeStats = document.getElementById('includeStats').checked;
        const includePageNumbers = document.getElementById('includePageNumbers').checked;
        
        let marginValue;
        switch(margin) {
            case 'narrow': marginValue = '1.27cm'; break;
            case 'wide': marginValue = '3.81cm'; break;
            default: marginValue = '2.54cm';
        }
        
        let paperWidth, paperHeight;
        if (paperSize === 'Letter') {
            paperWidth = pageOrientation === 'portrait' ? '21.59cm' : '27.94cm';
            paperHeight = pageOrientation === 'portrait' ? '27.94cm' : '21.59cm';
        } else if (paperSize === 'Legal') {
            paperWidth = pageOrientation === 'portrait' ? '21.59cm' : '35.56cm';
            paperHeight = pageOrientation === 'portrait' ? '35.56cm' : '21.59cm';
        } else { // A4
            paperWidth = pageOrientation === 'portrait' ? '21cm' : '29.7cm';
            paperHeight = pageOrientation === 'portrait' ? '29.7cm' : '21cm';
        }
        
        const currentDate = new Date().toLocaleDateString('ko-KR');
        const currentTime = new Date().toLocaleTimeString('ko-KR');
        
        let documentContent = '';
        
        // 제목 추가
        if (title) {
            documentContent += `
                <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #667eea; padding-bottom: 15px;">
                    <h1 style="margin: 0; color: #333; font-size: ${parseInt(fontSize) + 4}pt; font-weight: bold;">${title}</h1>
                </div>
            `;
        }
        
        // 작성자와 날짜 정보
        let metaInfo = '';
        if (author || includeDate) {
            metaInfo += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 10px; background-color: #f8f9fa; border-radius: 5px; font-size: ' + (parseInt(fontSize)-1) + 'pt;">';
            
            if (author) {
                metaInfo += `<div><strong>작성자:</strong> ${author}</div>`;
            }
            
            if (includeDate) {
                metaInfo += `<div><strong>작성일:</strong> ${currentDate} ${currentTime}</div>`;
            }
            
            metaInfo += '</div>';
            documentContent += metaInfo;
        }
        
        // 본문 내용
        const textContent = finalHTML || escapeHtml(processedText);
        documentContent += `
            <div style="text-align: justify; text-indent: 0pt; margin-bottom: 20px;">
                ${textContent}
            </div>
        `;
        
        // 통계 정보 추가
        if (includeStats) {
            const originalLines = originalText.split(/\r?\n/).length;
            const originalDots = (originalText.match(/\./g) || []).length;
            const originalLength = originalText.length;
            const processedLength = processedText.length;
            const highlightCount = highlights.length;
            
            documentContent += `
                <div style="page-break-before: avoid; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc;">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: ${parseInt(fontSize) + 2}pt;">📊 문서 처리 통계</h3>
                    <table style="width: 100%; border-collapse: collapse; font-size: ${parseInt(fontSize)-1}pt;">
                        <tr style="background-color: #f0f0f0;">
                            <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">항목</td>
                            <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">수치</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">제거된 줄바꿈</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${originalLines - 1}개</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">제거된 마침표</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${originalDots}개</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">원본 글자수</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${originalLength.toLocaleString()}자</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">처리 후 글자수</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${processedLength.toLocaleString()}자</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">적용된 강조</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${highlightCount}개</td>
                        </tr>
                    </table>
                </div>
            `;
        }
        
        // Word XML 형식으로 생성 (더 나은 호환성)
        const wordDocument = 

<?xml version="1.0" encoding="UTF-8"?>

<html xmlns:v="urn:schemas-microsoft-com:vml"
      xmlns:o="urn:schemas-microsoft-com:office:office"
      xmlns:w="urn:schemas-microsoft-com:office:word"
      xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
      xmlns="http://www.w3.org/TR/REC-html40">
<head>
    <meta charset="UTF-8">
    <meta name="ProgId" content="Word.Document">
    <meta name="Generator" content="Microsoft Word 15">
    <meta name="Originator" content="Microsoft Word 15">
    <title>${title}</title>
    <!--[if gte mso 9]>
    <xml>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>90</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
        @page {
            size: ${paperWidth} ${paperHeight};
            margin: ${marginValue};
            ${includePageNumbers ? 'mso-footer-margin: 1.27cm;' : ''}
        }
        @page :first {
            mso-title-page: yes;
        }
        body {
            font-family: '${fontFamily}', 'Times New Roman', serif;
            font-size: ${fontSize}pt;
            line-height: ${lineHeight};
            color: #000000;
            background: white;
            margin: 0;
            padding: 0;
            mso-line-height-rule: exactly;
        }
        h1, h2, h3, h4, h5, h6 {
            page-break-after: avoid;
            mso-outline-level: 1;
        }
        h1 {
            font-size: ${parseInt(fontSize) + 4}pt;
            font-weight: bold;
            margin: 0 0 18pt 0;
        }
        h3 {
            font-size: ${parseInt(fontSize) + 2}pt;
            font-weight: bold;
            margin: 18pt 0 12pt 0;
        }
        p {
            margin: 0 0 6pt 0;
            text-align: justify;
            mso-pagination: widow-orphan;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            mso-table-layout-alt: fixed;
        }
        td {
            border: 1pt solid #DDDDDD;
            padding: 4pt 8pt;
            mso-border-alt: solid #DDDDDD .5pt;
        }
        .highlight {
            background-color: yellow;
            mso-highlight: yellow;
        }
        ${includePageNumbers ? `
        @page {
            @bottom-center {
                content: counter(page);
            }
        }` : ''}
    @media print {
        body { 
            -webkit-print-color-adjust: exact; 
            color-adjust: exact;
            print-color-adjust: exact;
        }
    }
</style>

</head>
<body>
    ${documentContent}
    ${includePageNumbers ? `
    <div style="position: fixed; bottom: 1cm; width: 100%; text-align: center; font-size: ${parseInt(fontSize)-2}pt; color: #666;">
        <span style="mso-field-code: PAGE">1</span>
    </div>` : ''}
</body>
</html>;

        // 파일 확장자와 MIME 타입 결정
        let fileName, mimeType;
        switch(docFormat) {
            case 'docx':
                fileName = `${title.replace(/[<>:"/\\|?*]/g, '_')}.docx`;
                mimeType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';
                break;
            case 'rtf':
                fileName = `${title.replace(/[<>:"/\\|?*]/g, '_')}.rtf`;
                mimeType = 'application/rtf';
                break;
            default: // doc
                fileName = `${title.replace(/[<>:"/\\|?*]/g, '_')}.doc`;
                mimeType = 'application/msword';
        }

        // 파일 다운로드
        const blob = new Blob([wordDocument], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert(`${docFormat.toUpperCase()} 문서가 성공적으로 생성되었습니다!\n\n파일명: ${fileName}\n\nMicrosoft Word나 호환 프로그램에서 열어보세요.`);
        togglePrintSettings();
    }

    function previewDocument() {
        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }
        
        const title = document.getElementById('docTitle').value || '처리된 텍스트 문서';
        const fontSize = document.getElementById('fontSize').value;
        const fontFamily = document.getElementById('fontFamily').value;
        const lineHeight = document.getElementById('lineHeight').value;
        
        const previewContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>${escapeHtml(title)} - 미리보기</title>
                <style>
                    body {
                        font-family: '${fontFamily}', Arial, sans-serif;
                        font-size: ${fontSize}pt;
                        line-height: ${lineHeight};
                        margin: 2cm;
                        background: white;
                        color: #000;
                        max-width: 21cm;
                        margin: 2cm auto;
                        box-shadow: 0 0 20px rgba(0,0,0,0.1);
                        padding: 2cm;
                    }
                    h1 { 
                        text-align: center; 
                        margin-bottom: 30px; 
                        border-bottom: 2px solid #667eea;
                        padding-bottom: 15px;
                    }
                    .content { text-align: justify; }
                </style>
            </head>
            <body>
                <h1>${escapeHtml(title)}</h1>
                <div class="content">${finalHTML || escapeHtml(processedText)}</div>
            </body>
            </html>
        `;
        
        const previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
        previewWindow.document.write(previewContent);
        previewWindow.document.close();
    }

    function exportToPDF() {
        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }
        
        const title = document.getElementById('docTitle').value || '처리된 텍스트 문서';
        const fontSize = document.getElementById('fontSize').value;
        const fontFamily = document.getElementById('fontFamily').value;
        const lineHeight = document.getElementById('lineHeight').value;
        
        const pdfContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>${escapeHtml(title)}</title>
                <style>
                    @page {
                        size: A4;
                        margin: 2cm;
                    }
                    body {
                        font-family: '${fontFamily}', Arial, sans-serif;
                        font-size: ${fontSize}pt;
                        line-height: ${lineHeight};
                        color: #000;
                        margin: 0;
                    }
                    h1 { 
                        text-align: center; 
                        margin-bottom: 30px;
                        border-bottom: 2px solid #667eea;
                        padding-bottom: 15px;
                    }
                    .content { 
                        text-align: justify;
                        page-break-inside: avoid;
                    }
                    @media print {
                        body { -webkit-print-color-adjust: exact; color-adjust: exact; }
                    }
                </style>
            </head>
            <body>
                <h1>${escapeHtml(title)}</h1>
                <div class="content">${finalHTML || escapeHtml(processedText)}</div>
            </body>
            </html>
        `;
        
        const pdfWindow = window.open('', '_blank');
        pdfWindow.document.write(pdfContent);
        pdfWindow.document.close();
        pdfWindow.focus();
        
        setTimeout(() => {
            pdfWindow.print();
            alert('PDF로 저장하려면 인쇄 대화상자에서 "PDF로 저장" 옵션을 선택하세요.');
        }, 500);
    }
                        text-align: center; 
                        margin-bottom: 30px; 
                        border-bottom: 2px solid #667eea;
                        padding-bottom: 15px;
                    }
                    .content { text-align: justify; }
                </style>
            </head>
            <body>
                <h1>${title}</h1>
                <div class="content">${finalHTML || escapeHtml(processedText)}</div>
            </body>
            </html>
        `;
        
        const previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
        previewWindow.document.write(previewContent);
        previewWindow.document.close();
    }

    function exportToPDF() {
        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }
        
        const title = document.getElementById('docTitle').value || '처리된 텍스트 문서';
        const fontSize = document.getElementById('fontSize').value;
        const fontFamily = document.getElementById('fontFamily').value;
        const lineHeight = document.getElementById('lineHeight').value;
        
        const pdfContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>${title}</title>
                <style>
                    @page {
                        size: A4;
                        margin: 2cm;
                    }
                    body {
                        font-family: '${fontFamily}', Arial, sans-serif;
                        font-size: ${fontSize}pt;
                        line-height: ${lineHeight};
                        color: #000;
                        margin: 0;
                    }
                    h1 { 
                        text-align: center; 
                        margin-bottom: 30px;
                        border-bottom: 2px solid #667eea;
                        padding-bottom: 15px;
                    }
                    .content { 
                        text-align: justify;
                        page-break-inside: avoid;
                    }
                    @media print {
                        body { -webkit-print-color-adjust: exact; color-adjust: exact; }
                    }
                </style>
            </head>
            <body>
                <h1>${title}</h1>
                <div class="content">${finalHTML || escapeHtml(processedText)}</div>
            </body>
            </html>
        `;
        
        const pdfWindow = window.open('', '_blank');
        pdfWindow.document.write(pdfContent);
        pdfWindow.document.close();
        pdfWindow.focus();
        
        setTimeout(() => {
            pdfWindow.print();
            alert('PDF로 저장하려면 인쇄 대화상자에서 "PDF로 저장" 옵션을 선택하세요.');
        }, 500);
    }

    function printDocument() {
        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }
        
        const title = document.getElementById('docTitle').value || '처리된 텍스트 문서';
        const printContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>${title}</title>
                <style>
                    @media print {
                        body { -webkit-print-color-adjust: exact; color-adjust: exact; }
                    }
                    body {
                        font-family: Arial, sans-serif;
                        font-size: 12pt;
                        line-height: 1.5;
                        margin: 2cm;
                        color: #000;
                    }
                    h1 { text-align: center; margin-bottom: 30px; }
                    .content { text-align: justify; }
                </style>
            </head>
            <body>
                <h1>${title}</h1>
                <div class="content">${finalHTML || escapeHtml(processedText)}</div>
            </body>
            </html>
        `;
        
        const printWindow = window.open('', '_blank');
        printWindow.document.write(printContent);
        printWindow.document.close();
        printWindow.focus();
        setTimeout(() => {
            printWindow.print();
            printWindow.close();
        }, 500);
    }

    function showStats() {
        const originalLines = originalText.split(/\r?\n/).length;
        const originalDots = (originalText.match(/\./g) || []).length;
        const originalLength = originalText.length;
        const processedLength = processedText.length;

        stats.innerHTML = `
            <div class="stat-item">제거된 줄바꿈: ${originalLines - 1}개</div>
            <div class="stat-item">제거된 마침표: ${originalDots}개</div>
            <div class="stat-item">원본 글자수: ${originalLength.toLocaleString()}자</div>
            <div class="stat-item">처리 후 글자수: ${processedLength.toLocaleString()}자</div>
        `;
    }

    function copyResult() {
        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }

        navigator.clipboard.writeText(processedText).then(() => {
            alert('결과가 클립보드에 복사되었습니다!');
        }).catch(() => {
            // 클립보드 API가 지원되지 않는 경우
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = processedText;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextarea);
            alert('결과가 클립보드에 복사되었습니다!');
        });
    }

    function copyResultAsHTML() {
        if (!finalHTML) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }

        const htmlContent = `<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>강조된 텍스트</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
    </style>
</head>
<body>
    ${finalHTML}
</body>
</html>;

        navigator.clipboard.writeText(htmlContent).then(() => {
            alert('HTML 코드가 클립보드에 복사되었습니다!');
        }).catch(() => {
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = htmlContent;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextarea);
            alert('HTML 코드가 클립보드에 복사되었습니다!');
        });
    }

    function downloadResult() {
        if (!processedText) {
            alert('먼저 텍스트를 처리해주세요.');
            return;
        }

        // 강조가 있으면 HTML 파일로, 없으면 텍스트 파일로 다운로드
        if (highlights.length > 0) {
            const htmlContent = `<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>강조된 텍스트</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            line-height: 1.6; 
            max-width: 800px; 
            margin: 0 auto;
        }
    </style>
</head>
<body>
    ${finalHTML}
</body>
</html>`;

            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'highlighted_text.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        } else {
            const blob = new Blob([processedText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'processed_text.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    }

    function clearAll() {
        inputText.value = '';
        resultText.innerHTML = '';
        fileInfo.innerHTML = '';
        stats.innerHTML = '';
        resultSection.style.display = 'none';
        highlightControls.style.display = 'none';
        highlightList.style.display = 'none';
        printSettings.style.display = 'none';
        downloadBtn.style.display = 'none';
        originalText = '';
        processedText = '';
        highlights = [];
        finalHTML = '';
        fileInput.value = '';
        document.getElementById('highlightText').value = '';
    }
</script>
</body>
</html>